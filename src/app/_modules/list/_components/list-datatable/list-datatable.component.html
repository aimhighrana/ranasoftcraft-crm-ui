<div class="f-col root">
    <div class="f-row-spacer-half"></div>
    <div class="f-row">
        <lib-text-line type="leading"> 
            {{ objectType && objectType.objectdesc ? objectType.objectdesc: 'Untitled' }} - {{ currentView.viewName || 'Default view' }}
        </lib-text-line>
        <lib-button type="plain" iconFontType="solid" [matMenuTriggerFor]="menu" icon="caret-down"></lib-button>
        <mat-menu #menu="matMenu" class="navigation-menu">
            <div class="menu-customdropdown" prosInfiniteScroll bufferPercentage="20" (scrollEnd)="getViewsList(true)">

                <lib-section text="My views" *ngIf="userViews && userViews.length"></lib-section>
                <button mat-menu-item *ngFor="let userView of userViews" (click)="getViewDetails(userView.viewId)">
                    {{ userView.viewName }}
                </button>

                <lib-section text="System views" *ngIf="systemViews && systemViews.length"></lib-section>
                <button mat-menu-item *ngFor="let systemView of systemViews"
                    (click)="getViewDetails(systemView.viewId)">
                    {{ systemView.viewName }}
                </button>
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="openTableViewSettings()">
                <mat-icon fontSet="mdo-icons-light" class="mat-menu-icon">plus</mat-icon><span i18n="@@new_view"> New view
                </span>
            </button>
        </mat-menu>
        <span class="f-col-spacer-half"></span>
        <span class="f-spacer"></span>
        <div class="f-row action-iconbtns">
            <lib-button type="plain" iconFontType="solid" [matMenuTriggerFor]="navigation" icon="ellipsis-h">
            </lib-button>
            <mat-menu #navigation="matMenu" class="navigation-menu">
                <button mat-menu-item (click)="openTableViewSettings(true)" i18n="@@configure_view"> Configure view
                </button>
                <button mat-menu-item (click)="deleteView(currentView.viewId)" i18n="@@delete_view"
                    *ngIf="!currentView.isSystemView"> Delete view
                </button>
            </mat-menu>
        </div>
    </div>

    <div class="row-spacer"></div>

    <div class="f-row">
        <lib-search i18n-placeholder="@@search" placeholder="Search..." class="lib-search" (click)="showGlobalFilter = true" (blur)="showGlobalFilter  = false "></lib-search>
        <span class="f-col-spacer-half"></span>
        <lib-chip icon="filter" [libBadge]="filtersList && filtersList.filterCriteria ? filtersList.filterCriteria.length || '' : ''" 
            (click)="openFiltersSideSheet()"></lib-chip>
        <span class="f-col-spacer-half"></span>
        <lib-chip icon="ellipsis-h" *ngIf="filtersList && (filtersList.filterId || filtersList.filterCriteria.length)"
            [matMenuTriggerFor]="filterMenu"></lib-chip>
        <mat-menu #filterMenu="matMenu">
            <button mat-menu-item (click)="saveFilterCriterias()"> Save as... </button>
            <button mat-menu-item (click)="resetAllFilters()"> Reset </button>
        </mat-menu>

    </div>
    
    <ng-template [ngIf]="showGlobalFilter">
        <pros-global-search></pros-global-search>
    </ng-template>

    <div class="row-spacer"></div>
    <div class="data-listing">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0" [ngStyle]="{'min-width.px': tableWidth}">
            <ng-container matColumnDef="_select" sticky>
                <th mat-header-cell *matHeaderCellDef class="fixed-width-c1"
                    >
                    <lib-checkbox (valueChange)="masterToggle()" [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                    </lib-checkbox>
                </th>
                <td mat-cell *matCellDef="let element" class="fixed-width-c1"
                    [ngClass]="{'mdo-row-warning': rowHasWarning(element), 'mdo-row-error': rowHasError(element)}">
                    <lib-checkbox (valueChange)="selection.toggle(element)" [checked]="selection.isSelected(element)"
                        [aria-label]="checkboxLabel(element)"></lib-checkbox>
                </td>
            </ng-container>

            <ng-container matColumnDef="_settings" sticky>
                <th mat-header-cell *matHeaderCellDef class="fixed-width-c1">
                    <lib-button icon="cog" (click)="openTableViewSettings(true)"></lib-button>
                </th>
                <td mat-cell *matCellDef="let element" class="fixed-width-c1">
                    <!-- <lib-button-group>
                        <lib-button type="minor" iconFontType="solid" icon="ellipsis-h"></lib-button>
                        <lib-button type="minor" iconFontType="solid" icon="check"></lib-button>
                        <lib-button type="minor" iconFontType="solid" icon="ban"></lib-button>
                    </lib-button-group> -->
                </td>
            </ng-container>

            <ng-container matColumnDef="OBJECTNUMBER" class="fixed-width-c2" sticky>
                <th mat-header-cell *matHeaderCellDef>
                    Object Number
                </th>
                <td mat-cell *matCellDef="let element" class="fixed-width-c2">
                    {{ element.OBJECTNUMBER.fieldData}}
                </td>
            </ng-container>

            <ng-template ngFor let-dynCol let-index="index" [ngForOf]="(displayedColumns | async)">
                <ng-template [ngIf]="isStaticCol(dynCol)" [ngIfElse]="dynamic">
                    <!-- skip all static columns -->
                </ng-template>
                <ng-template #dynamic>
                    <ng-container [matColumnDef]="dynCol"> <!-- mat-sort-header [start]="getColumnSortDir(dynCol)" -->
                        <th mat-header-cell *matHeaderCellDef
                            [ngStyle]="{'width.px': getColumnWidth(dynCol)}"
                            [ngClass]="{'large-cell-header': isLargeHeader(dynCol)}"
                            prosResizableColumn [index]="index"
                            (widthChanged)="onColumnsResize($event)"
                            [id]="dynCol">
                            {{ getFieldDesc(dynCol) }}
                        </th>
                        <td mat-cell *matCellDef="let element"
                            [ngClass]="{'large-cell-content': isLargeCell(element, dynCol)}">
                            {{ element[dynCol] ? element[dynCol].fieldData || '' : ''}}
                        </td>
                    </ng-container>
                </ng-template>
            </ng-template>

            <tr mat-header-row *matHeaderRowDef="displayedColumns | async; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns | async;"></tr>
        </table>
    </div>
    <div class="f-row-spacer-half"></div>
    <div class="pagination-section">
        <lib-pagination [currentPageIndex]="recordsPageIndex" [totalCount]="totalCount" [pageSize]="recordsPageSize"
            (pageChangeEvent)="onPageChange($event)">
        </lib-pagination>
        <span>
            {{ displayedRecordsRange }}
        </span>
    </div>

    <div class="f-row-spacer-half"></div>

    <ng-template>
        <!-- Configure loading -->
        <div class="f-col loading-result">
            <pros-null-state [button]="{text: 'Configure'}" [iconWidth]="160"
                [iconPath]="'./assets/images/empty-table.svg'" [subtext]="'View is not configured'"
                [message]="'Please configure your view by selecting columns to display'"></pros-null-state>
        </div>
    </ng-template>
</div>