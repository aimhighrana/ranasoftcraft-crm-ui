<div class="f-col root">
    <div class="f-row-spacer-half"></div>
    <div class="f-row">
        <lib-text-line type="leading">Material - {{ currentView.viewName || 'Default view' }}</lib-text-line>
        <lib-button type="plain" iconFontType="solid" [matMenuTriggerFor]="menu" icon="caret-down"></lib-button>
        <mat-menu #menu="matMenu" class="navigation-menu">
            <div class="menu-customdropdown" prosInfiniteScroll bufferPercentage="10" (scrollEnd)="getViewsList(true)">

                <lib-section text="My views" *ngIf="userViews && userViews.length"></lib-section>
                <button mat-menu-item *ngFor="let userView of userViews" (click)="updateTableColumns(userView.viewId)">
                    {{ userView.viewName }}
                </button>

                <lib-section text="System views" *ngIf="systemViews && systemViews.length"></lib-section>
                <button mat-menu-item *ngFor="let systemView of systemViews"
                    (click)="updateTableColumns(systemView.viewId)">
                    {{ systemView.viewName }}
                </button>
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="openTableViewSettings()">
                <mat-icon fontSet="mdo-icons" class="mat-menu-icon">plus</mat-icon><span i18n="@@new_view"> New view </span>
            </button>
        </mat-menu>
        <span class="f-col-spacer-half"></span>
        <span class="f-spacer"></span>
        <div class="f-row action-iconbtns">
            <lib-button type="plain" iconFontType="solid" [matMenuTriggerFor]="navigation" icon="ellipsis-h"></lib-button>
            <mat-menu #navigation="matMenu" class="navigation-menu">
                <button mat-menu-item (click)="openTableViewSettings(true)" i18n="@@configure_view"> Configure view </button>
                <button mat-menu-item (click)="deleteView(currentView.viewId)" i18n="@@delete_view"> Delete view </button>
            </mat-menu>
        </div>
    </div>

    <div class="row-spacer"></div>

    <div class="f-row">
        <lib-search i18n-placeholder="@@search" placeholder="Search..."></lib-search>
    </div>

    <div class="row-spacer"></div>
    <div class="data-listing">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z0">
            <ng-container matColumnDef="_select" sticky>
                <th mat-header-cell *matHeaderCellDef>
                    <lib-checkbox (valueChange)="masterToggle()" [checked]="selection.hasValue() && isAllSelected()"
                    [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()"> 
                </lib-checkbox>
                </th>
                <td mat-cell *matCellDef="let element"
                    [ngClass]="{'mdo-row-warning': rowHasWarning(element), 'mdo-row-error': rowHasError(element)}">
                    <lib-checkbox (valueChange)="selection.toggle(element)" [checked]="selection.isSelected(element)"
                    [aria-label]="checkboxLabel(element)"></lib-checkbox>
                </td>
            </ng-container>

            <ng-container matColumnDef="_settings">
                <th mat-header-cell *matHeaderCellDef>
                    <lib-button icon="cog" (click)="openTableViewSettings(true)"></lib-button>
                </th>
                <td mat-cell *matCellDef="let element">
                    <!-- <lib-button-group>
                        <lib-button type="minor" iconFontType="solid" icon="ellipsis-h"></lib-button>
                        <lib-button type="minor" iconFontType="solid" icon="check"></lib-button>
                        <lib-button type="minor" iconFontType="solid" icon="ban"></lib-button>
                    </lib-button-group> -->
                </td>
            </ng-container>

            <ng-container matColumnDef="OBJECTNUMBER" sticky>
                <th mat-header-cell *matHeaderCellDef>
                    Object Number
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.OBJECTNUMBER.fieldData}}
                </td>
            </ng-container>

            <ng-template ngFor let-dynCol [ngForOf]="(displayedColumns | async)">
                <ng-template [ngIf]="isStaticCol(dynCol)" [ngIfElse]="dynamic">
                    <!-- skip all static columns -->
                </ng-template>
                <ng-template #dynamic>
                    <ng-container [matColumnDef]="dynCol">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ metadataFldLst && metadataFldLst.headers[dynCol] ?
                            metadataFldLst.headers[dynCol].fieldDescri : dynCol }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element[dynCol] ? element[dynCol].fieldData || '' : ''}}
                        </td>
                    </ng-container>
                </ng-template>
            </ng-template>

            <tr mat-header-row *matHeaderRowDef="displayedColumns | async; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns | async;"></tr>
        </table>
    </div>
    <div class="f-row-spacer-half"></div>
    <lib-pagination [currentPageIndex]="recordsPageIndex" 
        [totalCount]="totalCount" pageSize="50"
        (pageChangeEvent)="onPageChange($event)">
    </lib-pagination>

    <div class="f-row-spacer-half"></div>

    <ng-template>
        <!-- Configure loading -->
        <div class="f-col loading-result">
            <pros-null-state [button]="{text: 'Configure'}" [iconWidth]="160"
                [iconPath]="'./assets/images/empty-table.svg'" [subtext]="'View is not configured'"
                [message]="'Please configure your view by selecting columns to display'"></pros-null-state>
        </div>
    </ng-template>
</div>