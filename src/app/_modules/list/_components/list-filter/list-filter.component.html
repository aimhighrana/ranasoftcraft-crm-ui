<div class="root">
    <div class="f-row breadcrum-toolbar">
        <lib-button type="plain" icon="times" (click)="close()"></lib-button>
        <div class="col-spacer"></div>
        <div class="f-col mdo-constrained-right">
            <div class="f-col breadcrum-head">
                <div class="f-row">
                    <lib-segment [optionsList]="optionsList" labelKey="label" valueKey="value"></lib-segment>
                    <span class="f-col-spacer-half"></span>
                    <span class="f-spacer"></span>
                    <lib-button type="minor" (click)="clearAllFilters()" i18n="@@reset_all">Reset all</lib-button>
                </div>
            </div>
        </div>
    </div>
    <div class="row-spacer"></div>
    <div class="f-col sidesheetcontent-listing">
        <div class="f-col mdo-justify">
            <div class="f-row filter-container">
                <div class="f-col filter-fields-col">
                    <lib-search i18n-placeholder="@@search" placeholder="Search"
                        (valueChange)="searchFieldSub.next($event)">
                    </lib-search>
                    <div class="row-spacer"></div>
                    <div class="filters-list" prosInfiniteScroll 
                        bufferPercentage="20" (scrollEnd)="getModuleFldMetadata(true)">
                        <mat-list>
                            <mat-list-item class="f-row" *ngFor="let filter of suggestedFilters; let index=index">
                                <div class="f-col" (click)="upsertFilter(filter.fieldId)">
                                    <lib-text-line type="base"> {{ getFieldDescription(filter.fieldId) }}
                                    </lib-text-line>
                                    <lib-text-line type="base" textColor="secondary"> 
                                        {{ FormatFilterValue(filter) }}
                                    </lib-text-line>
                                </div>
                                <span class="f-spacer"></span>
                                <span class="f-col-spacer-half"></span>
                                <lib-button type="plain" iconFontType="solid" icon="times"
                                    (click)="removeFilter(index, filter.fieldId)"></lib-button>
                            </mat-list-item>
                        </mat-list>
                        <lib-section></lib-section>
                        <div class="f-row">
                            <span class="col-spacer"></span>
                            <lib-text-line type="base" weight="strong" textColor="secondary">
                                <span i18n="@@apply_filters">Apply filters...</span></lib-text-line>
                        </div>
                        <mat-list>
                            <!-- Todo: hide already applied field filters -->
                            <mat-list-item *ngFor="let field of moduleFieldsMetatdata"
                                (click)="upsertFilter(field.fieldId)">
                                <lib-text-line type="base" enableWrap="flase">{{ field.fieldDescri }}</lib-text-line>
                            </mat-list-item>
                        </mat-list>
                    </div>
                </div>
                <div class="col-spacer"></div>
                <div class="f-col filter-values-col">
                    <ng-template [ngIf]="activeFilter">
                        <div class="f-row">
                            <lib-text-line type="base" weight="strong"> {{ getFieldDescription(activeFilter.fieldId) }}
                            </lib-text-line>
                            <span class="f-spacer"></span>
                            <lib-button type="type">
                                <mat-icon fontSet="mdo-icons-solid">sliders-h</mat-icon>
                            </lib-button>
                            <lib-button-group>
                                <lib-button type="major" (click)="applyFilter()" i18n="@@apply">Apply</lib-button>
                                <lib-button type="major" icon="ellipsis-h"></lib-button>
                            </lib-button-group>
                        </div>
                        <div class="row-spacer"></div>
                        <div class="f-col">
                            <ng-container [ngSwitch]="getFieldControlType(activeFilter.fieldId)">
                                <!-- Text, Password, Email -->
                                <lib-input
                                    *ngSwitchCase="[FieldControlType.TEXT, FieldControlType.EMAIL, FieldControlType.PASSWORD].includes(getFieldControlType(activeFilter.fieldId)) ? getFieldControlType(activeFilter.fieldId): !getFieldControlType(activeFilter.fieldId) "
                                    i18n-placeholder="@@type_filter_value" placeholder="type filter value"
                                    [value]="getFilterValue(activeFilter)"
                                    (valueChange)="updateFilterValue($event)"></lib-input>

                                <!-- input type Text area -->
                                <mat-form-field *ngSwitchCase="FieldControlType.TEXT_AREA" appearance="outline">
                                    <textarea matInput class="mdo-textarea" i18n-placeholder="@@type_filter_value"
                                        placeholder="type filter value"
                                        [value]="getFilterValue(activeFilter)"
                                        (change)="updateFilterValue($event.target.value)"></textarea>
                                </mat-form-field>

                                <!-- Input type number -->
                                <lib-range-slider *ngSwitchCase="FieldControlType.NUMBER" thumbLabel
                                    [value]="activeFilter.startValue || 0" [highValue]="activeFilter.endValue || 1"
                                    (valueChange)="updateFilterValue($event)"></lib-range-slider>

                                <!-- Single select -->
                                <ng-container *ngSwitchCase="FieldControlType.SINGLE_SELECT">
                                    <lib-text-line type="base" weight="strong" i18n="@@rule">Rule</lib-text-line>
                                    <lib-segment [optionsList]="rulelist" labelKey="label" valueKey="value"
                                        [(ngModel)]="activeFilter.operator"></lib-segment>

                                    <lib-section></lib-section>
                                    <lib-search placeholder="Search"></lib-search>
                                    <div class="row-spacer"></div>
                                    <lib-section></lib-section>
                                    <mat-list>
                                        <lib-radio-group layout="vertical"
                                            [value]="getFilterValue(activeFilter)"
                                            [options]="dropdownValues"
                                            (valueChange)="updateFilterValue($event)"></lib-radio-group>
                                    </mat-list>
                                </ng-container>

                                <!-- Multi select -->
                                <ng-container *ngSwitchCase="FieldControlType.MULTI_SELECT">
                                    <lib-text-line type="base" weight="strong" i18n="@@rule">Rule</lib-text-line>
                                    <lib-segment [optionsList]="rulelist" labelKey="label" valueKey="value"
                                        [(ngModel)]="activeFilter.operator"></lib-segment>

                                    <lib-section></lib-section>
                                    <lib-search placeholder="Search"></lib-search>
                                    <div class="row-spacer"></div>
                                    <div class="f-row">
                                        <span class="col-spacer"></span>
                                        <lib-slide-toggle i18n-label="@@show_selected" label="Show selected" labelPosition="after" theme="primary">
                                        </lib-slide-toggle>
                                    </div>
                                    <div class="row-spacer"></div>
                                    <mat-list>
                                        <mat-list-item>
                                            <lib-checkbox label="Select all" labelPosition="after" theme="primary"></lib-checkbox>
                                        </mat-list-item>
                                        <lib-section></lib-section>
                                        <mat-list-item *ngFor="let option of dropdownValues">
                                            <lib-checkbox [label]="option.value" labelPosition="after" theme="primary"
                                            [checked]="activeFilter.values.includes(option.key)"
                                            (valueChange)="updateFilterValue(option.key)"></lib-checkbox>
                                        </mat-list-item>
                                    </mat-list>
                                </ng-container>

                                <!-- Date -->
                                <ng-container *ngSwitchCase="FieldControlType.DATE">
                                    <div class="f-row system">
                                        <div class="f-col date-list">
                                            <mat-list>
                                                <mat-list-item *ngFor="let filterMetadata of DATE_FILTERS_METADATA"    
                                                    (click)="dateFilterSelected(filterMetadata)">
                                                    <lib-text-line type="base"> {{ filterMetadata.label }} </lib-text-line>
                                                    <span class="f-spacer"></span>
                                                    <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                                </mat-list-item>
                                            </mat-list>
                                        </div>
                                        <div class="col-spacer"></div>
                                        <ng-container>
                                            <ng-container [ngSwitch]="activeFilter.unit">

                                                <!-- static date -->
                                                <mat-form-field *ngSwitchCase="'static_date'" class="f-col date-list" appearance="outline">
                                                    <mat-label>Choose a date</mat-label>
                                                    <input matInput [matDatepicker]="picker" 
                                                        [value]="getFilterValue(activeFilter)"
                                                        (dateChange)="updateFilterValue($event.value)">
                                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                    <mat-datepicker #picker></mat-datepicker>
                                                </mat-form-field>

                                                <!-- static date range -->
                                                <mat-form-field *ngSwitchCase="'static_range'" class="f-col date-list" appearance="outline">
                                                    <mat-label>Enter a date range</mat-label>
                                                    <mat-date-range-input [rangePicker]="picker" #rangeInput>
                                                      <input matStartDate placeholder="Start date" 
                                                        [value]="getFilterValue(activeFilter).start"
                                                        (dateChange)="updateFilterValue(rangeInput.value)">
                                                      <input matEndDate placeholder="End date" 
                                                        [value]="getFilterValue(activeFilter).end"
                                                        (dateChange)="updateFilterValue(rangeInput.value)">
                                                    </mat-date-range-input>
                                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                    <mat-date-range-picker #picker></mat-date-range-picker>
                                                </mat-form-field>

                                                <!-- Dynamic date range -->
                                                <div *ngSwitchDefault class="f-col date-list">
                                                    <lib-radio-group layout="vertical" *ngIf="dateFilterOptions.length"
                                                        [options]="dateFilterOptions"
                                                        [value]="getFilterValue(activeFilter)"
                                                        (valueChange)="updateFilterValue($event.key)"></lib-radio-group>
                                                </div>
                                            </ng-container>

                                        </ng-container>
                                    </div>
                                </ng-container>

                                <!-- Time -->
                                <ng-container *ngSwitchCase="FieldControlType.TIME">
                                    <lib-tab-group disableRipple="true">
                                        <lib-tab i18n-label="@@start" label="Start">
                                            <div class="f-row">
                                                <lib-input type="number" minimum="0" maximum="23" #startHour
                                                    [value]="getFilterValue(activeFilter).startHour"
                                                    (valueChange)="timefilterChange($event, 'startHour')">
                                                </lib-input>
                                                <span> : </span>
                                                <lib-input type="number" minimum="0" maximum="59" #startMinutes
                                                    [value]="getFilterValue(activeFilter).startMinutes"
                                                    (valueChange)="timefilterChange($event, 'startMinutes')">
                                                </lib-input>
                                                <span class="f-spacer"></span>
                                            </div>
                                        </lib-tab>
                                        <lib-tab i18n-label="@@end" label="End">
                                            <div class="f-row">
                                                <lib-input type="number" 
                                                    [minimum]="startHour.control.value" maximum="23" #endHour
                                                    [value]="getFilterValue(activeFilter).endHour"
                                                    (valueChange)="timefilterChange($event, 'endHour')">
                                                </lib-input>
                                                <span> : </span>
                                                <lib-input type="number" 
                                                    [minimum]="startHour.control.value === endHour.control.value ? startMinutes.control.value : 0" 
                                                    maximum="59" #endMinutes
                                                    [value]="getFilterValue(activeFilter).endMinutes"
                                                    (valueChange)="timefilterChange($event, 'endMinutes')">
                                                </lib-input>
                                                <span class="f-spacer"></span>
                                            </div>
                                        </lib-tab>
                                    </lib-tab-group>
                                </ng-container>

                                <!-- Default input text -->
                                <lib-input *ngSwitchDefault i18n-placeholder="@@type_filter_value"
                                    placeholder="type filter value"
                                    [value]="getFilterValue(activeFilter)"
                                    (valueChange)="updateFilterValue($event)"></lib-input>
                            </ng-container>
                        </div>
                    </ng-template>

                    <!-- Location Tab -->
                    <ng-template>
                        <div class="f-row">
                            <lib-text-line type="base" weight="strong">Location</lib-text-line>
                            <span class="f-spacer"></span>
                            <lib-button type="type" libBadge="322" [matBadgeOverlap]="true">
                                <mat-icon fontSet="mdo-icons-solid">sliders-h</mat-icon>
                            </lib-button>
                            <span class="f-col-spacer-half"></span>
                            <lib-button-group>
                                <lib-button type="major">Apply</lib-button>
                                <lib-button type="major" icon="ellipsis-h"></lib-button>
                            </lib-button-group>
                        </div>
                        <div class="f-row-spacer-half"></div>
                        <div class="f-col">
                            <lib-text-line type="base" weight="strong">Rule</lib-text-line>
                            <lib-segment [optionsList]="rulelist" labelKey="label" valueKey="value"></lib-segment>
    
                            <lib-section></lib-section>
    
                            <lib-search placeholder="Search"></lib-search>
                            <div class="row-spacer"></div>
                            <div class="f-row">
                                <span class="col-spacer"></span>
                                <lib-slide-toggle label="Show selected" labelPosition="after" theme="primary">
                                </lib-slide-toggle>
                            </div>
                            <div class="row-spacer"></div>
                            <mat-list>
                                <mat-list-item>
                                    <lib-checkbox label="Select all" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <ng-template>
                                    <div class="f-row">
                                        <span class="col-spacer"></span>
                                        <lib-button type="plain" iconFontType="solid" icon="times"></lib-button>
                                        <span class="f-col-spacer-half"></span>
                                        <lib-text-line type="base">Remove all</lib-text-line>
                                    </div>
                                </ng-template>
                                <lib-section></lib-section>
                                <mat-list-item>
                                    <lib-checkbox label="Algeria" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <mat-list-item>
                                    <lib-checkbox label="America" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <mat-list-item>
                                    <lib-checkbox label="Austria" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <mat-list-item>
                                    <lib-checkbox label="Brussels" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <mat-list-item>
                                    <lib-checkbox label="France" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                                <mat-list-item>
                                    <lib-checkbox label="Germany" labelPosition="after" theme="primary"></lib-checkbox>
                                </mat-list-item>
                            </mat-list>
                        </div>
                    </ng-template>
                    
                    <!-- Approved date Tab -->
                    <ng-template>
                        <div class="f-row">
                            <lib-text-line type="base" weight="strong">Approved date</lib-text-line>
                            <span class="f-spacer"></span>
                            <lib-button type="type">
                                <mat-icon fontSet="mdo-icons-solid">sliders-h</mat-icon>
                            </lib-button>
                            <span class="f-col-spacer-half"></span>
                            <lib-button-group>
                                <lib-button type="major">Apply</lib-button>
                                <lib-button type="major" icon="ellipsis-h"></lib-button>
                            </lib-button-group>
                        </div>
                        <div class="f-row-spacer-half"></div>
                        <div class="f-row system">
                            <div class="f-col date-list">
                                <mat-list>
                                    <mat-list-item>
                                        <lib-text-line type="base">Day</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Week</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Month</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Quarter</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Year</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Specific date </lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <lib-text-line type="base">Date range</lib-text-line>
                                        <span class="f-spacer"></span>
                                        <mat-icon fontSet="mdo-icons-solid">long-arrow-alt-right</mat-icon>
                                    </mat-list-item>

                                </mat-list>
                            </div>
                            <div class="col-spacer"></div>
                            <div class="f-col date-list">
                                <lib-radio-group [options]="options" layout="vertical"></lib-radio-group>
                            </div>
                        </div>
                    </ng-template>

                    <!-- Period Tab -->
                    <ng-template>
                        <div class="f-row">
                            <lib-text-line type="base" weight="strong">Period</lib-text-line>
                            <span class="f-spacer"></span>
                            <span class="f-col-spacer-half"></span>
                            <lib-button type="minor">Save</lib-button>
                        </div>
                        <div class="f-row-spacer-half"></div>
                        <div class="f-row system">
                            <div class="f-col date-list">
                                <lib-radio-group [options]="periods" layout="vertical"></lib-radio-group>
                            </div>
                        </div>
                    </ng-template>

                    <!-- Numeric Range Tab -->
                    <ng-template>
                        <div class="f-row">
                            <lib-text-line type="base" weight="strong">Range</lib-text-line>
                            <span class="f-spacer"></span>
                            <lib-button type="type">
                                <mat-icon fontSet="mdo-icons-solid">sliders-h</mat-icon>
                            </lib-button>
                            <span class="f-col-spacer-half"></span>
                            <lib-button type="minor">Save</lib-button>
                        </div>
                        <div class="f-row-spacer-half"></div>
                        <div class="f-row system">
                            <div class="f-col date-list">
                                <lib-input></lib-input>
                                <lib-range-slider value="12"></lib-range-slider>
                            </div>
                        </div>
                    </ng-template>

                    <!-- Selectdropdown Tab -->
                    <ng-template>
                        <div class="f-col system-values-col">
                            <div class="f-row">
                                <lib-input placeholder="Select range"></lib-input>
                                <mat-menu #selectOptions="matMenu">
                                    <div class="f-col">
                                        <div class="f-row">
                                            <lib-text-line type="base">Rule</lib-text-line>
                                            <span class="f-spacer"></span>
                                            <lib-button type="plain" iconFontType="solid" icon="sliders-h"></lib-button>
                                        </div>
                                        <div class="f-row">
                                            <lib-search placeholder="Search"></lib-search>
                                        </div>
                                    </div>
                                    <mat-list>
                                        <mat-list-item>
                                            <lib-checkbox label="Algeria" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <lib-checkbox label="America" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <lib-checkbox label="Austria" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <lib-checkbox label="Brussels" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <lib-checkbox label="France" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <lib-checkbox label="Germany" labelPosition="after" theme="primary">
                                            </lib-checkbox>
                                        </mat-list-item>
                                    </mat-list>
                                </mat-menu>
                            </div>
                        </div>
                    </ng-template>

                    <!-- Single select drowdown Tab -->
                    <ng-template>
                        <div class="f-col system-values-col">
                            <div class="f-row">
                                <div class="f-col mdo-field">
                                    <mat-label class="mdo-field-label">Single-select</mat-label>
                                    <div class="mdo-field-input">
                                        {{selected}}
                                        <input matInput placeholder="Type to search" #optionInput2
                                            [formControl]="optionCtrl2" [matAutocomplete]="auto2" />
                                        <mat-icon matSuffix fontSet="mdo-icons">angle-down</mat-icon>

                                        <mat-autocomplete class="mdo-autocomplete" #auto2="matAutocomplete"
                                            (optionSelected)="selectSingle($event)">
                                            <mat-option class="mdo-option" *ngFor="let opt of filteredOptions | async"
                                                [value]="opt">
                                                {{opt}}
                                            </mat-option>
                                        </mat-autocomplete>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </ng-template>

                    <!-- Textarea Tab -->
                    <ng-template>
                        <div class="f-col system-values-col">
                            <div class="f-row">
                                <div class="f-col mdo-field">
                                    <mat-label class="mdo-field-label">Single-select</mat-label>
                                    <div class="mdo-field-input">
                                        <textarea></textarea>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
</div>