<div class="root">
    <div class="f-row breadcrum-toolbar">
        <lib-button type="plain" (click)="close()" iconFontType="light" icon="times"></lib-button>
        <div class="col-spacer"></div>
        <div class="f-col mdo-constrained-right">
            <div class="f-row breadcrum-head">
                <lib-text-line type="leading" i18n="@@data_scope">{{ variantName.value || 'New Data scope' }}</lib-text-line>
                <span class="f-col-spacer-half"></span>
                <span class="f-spacer"></span>
                <lib-button [disabled]="!variantName.value.trim() || !selectedFilterCriteria || !selectedFilterCriteria.length" i18n="@@save" type="major" (afterClick)="saveVarient()">Save</lib-button>
            </div>
        </div>
    </div>
    <div class="f-col sidesheetcontent-listing">
        <div class="f-col mdo-justify">
            <lib-banner status="info" text="Your scope contains {{scopeCnt}} records"></lib-banner>
            <div class="f-col">
                <lib-input class="mdo-scheduler-input" [formControl]="variantName" type="text"
                    [value]="variantInfo.variantName" i18n-label="@@name" label="Name"></lib-input>
            </div>
            <!--
            <div class="f-col mdo-field">
                <lib-text-line class="field-label" type="xsmall" weight="strong" i18n="@@scope">Scope</lib-text-line>
                <div class="f-row">
                    <lib-chip-list class="mdo-chip-list">
                        <ng-container *ngIf="variantInfo">
                            <ng-template ngFor let-ctrl [ngForOf]="variantInfo.filterCriteria">
                                <lib-chip label="{{ctrl.fldCtrl ? ctrl.fldCtrl.fieldDescri : 'Unknown'}}:"
                                    disableRipple="true" [matMenuTriggerFor]="appliedfiltermenu"
                                    (click)="loadDropValues(ctrl)" [removable]="true" type="info">
                                    {{prepareTextToShow(ctrl)}}</lib-chip>
                            </ng-template>
                        </ng-container>
                        <lib-chip class="mdo-filter-matchip" [matMenuTriggerFor]="addFilterMenu"
                            (click)="reInilize = !reInilize" iconFontType="solid" icon="filter"></lib-chip>
                        <mat-menu #addFilterMenu="matMenu">
                            <pros-add-filter-menu [moduleId]="moduleId" (evtReadyForApply)="makeFilterCtrl($event)"
                                [reInilize]="reInilize" [isSearchEnable]="true"
                                [alreadySelectedValues]="variantInfo.filterCriteria"></pros-add-filter-menu>
                        </mat-menu>
                    </lib-chip-list>

                    <mat-menu #appliedfiltermenu="matMenu">
                        <pros-filter-values [moduleId]="moduleId"
                            (selectedValues)="updateChipFilter($event, loadDropValuesFor.fieldId)"
                            [isSearchEnable]="true" [fieldId]="loadDropValuesFor ? loadDropValuesFor.fieldId : ''"
                            [checkedValue]="loadDropValuesFor ? loadDropValuesFor.checkedValue : []">
                        </pros-filter-values>
                    </mat-menu>
                </div>
            </div>
            -->
        </div>
    </div>

    <div class="filter-section f-row" *ngIf="allFilters.length">
        <div class="filter-list">
            <lib-search  placeholder="Search filters" (valueChange)=(triggerFilterSearch($event))></lib-search>
            <div class="filter-scroll">
                <mat-accordion>
                    <mat-expansion-panel togglePosition="before" class="mat-elevation-z0" *ngFor="let filter of selectedFiltersDisplayList; let i=index; trackBy:filterTrackBy" [hideToggle]="filter.type === 'header'" (click)="selectDynamicFilter(filter, true)">
                        <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                            <mat-panel-title class="mat-panel-title">
                                <lib-text-line class="list-item selected" [matTooltip]="filter.fieldDescri || ''">{{ filter.fieldDescri || '' }}</lib-text-line>
                                <lib-button *ngIf="filter.type === 'header'" type="plain" (click)="removeField(filter)" iconFontType="light" icon="times"></lib-button>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <mat-nav-list role="navigation" *ngIf="filter.child && filter.child.length">
                            <mat-list-item *ngFor="let child of filter.child" class="f-row" (click)="selectDynamicFilter(child, true)">
                                <div class="text-line selected">
                                    <lib-text-line [matTooltip]="child.fieldDescri || ''">{{ child.fieldDescri || '' }}</lib-text-line>
                                </div>
                                <div class="f-spacer"></div>
                                <div>
                                    <lib-button type="plain" (click)="removeField(child, true)" iconFontType="light" icon="times"></lib-button>
                                </div>
                            </mat-list-item>
                        </mat-nav-list>
                    </mat-expansion-panel>
                    <mat-divider></mat-divider>
                    <mat-expansion-panel togglePosition="before" class="mat-elevation-z0" *ngFor="let filter of filtersDisplayList; let i=index; trackBy:filterTrackBy" [hideToggle]="filter.type === 'header'" (click)="selectFilter(filter)" [class.hide]="!filter.show">
                        <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                            <mat-panel-title class="mat-panel-title">
                                <lib-text-line class="list-item" [matTooltip]="filter.fieldDescri || ''">{{ filter.fieldDescri || '' }}</lib-text-line>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <mat-nav-list role="navigation" *ngIf="filter.child && filter.child.length">
                            <mat-list-item *ngFor="let child of filter.child" (click)="selectFilter(child, true)" [class.hide]="!child.show">
                                <div class="text-line selected">
                                    <lib-text-line [matTooltip]="child.fieldDescri || ''">{{ child.fieldDescri || '' }}</lib-text-line>
                                </div>
                            </mat-list-item>
                        </mat-nav-list>
                    </mat-expansion-panel>
                </mat-accordion>
            </div>
        </div>
        <div class="dynamic-container">
            <ng-container *ngIf="filterControlType === 'input_text' || filterControlType === 'input_desc'">
                <div class="f-col mdo-form-field">
                    <lib-input [(ngModel)]="filterData.inputTextVal" (valueChange)="updateFilterValue($event)" type="text" label="Value"></lib-input>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'input_numeric'">
                <div class="f-col mdo-form-field">
                    <lib-input [(ngModel)]="filterData.inputNumericVal" (valueChange)="updateFilterValue($event)" type="number" label="Value"></lib-input>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'textarea'">
                <div class="f-col mdo-form-field">
                    <lib-textarea label="Description" [(ngModel)]="filterData.textareaVal" [rows]="4" (valueChange)="updateFilterValue($event)"></lib-textarea>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'checkbox'">
                <div class="f-col mdo-form-field">
                    <lib-checkbox *ngFor="let field of dropdownValues; let i = index" [checked]="field.checked" (valueChange)="checkboxChanged($event, field.CODE, i)" [label]="field.TEXT" labelPosition="after" theme="primary" class="lib-checkbox"></lib-checkbox>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'radio'">
                <div class="f-col mdo-form-field">
                    <lib-radio-group layout="vertical" [value]="filterData.selectedValue" [options]="dropdownValues" (valueChange)="updateFilterValue($event)"></lib-radio-group>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'picker_date'">
                <lib-date-time-range-picker [selectedDate]="dateRangeValue" [enableTimeInput]="true" (valueChange)="dateChanged($event)">
                </lib-date-time-range-picker>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'picker_time'">
                <lib-time-range-picker [selected]="selectedTimeRange" [enableTimeInput]="true" (valueChange)="timeRangeChanged($event)"></lib-time-range-picker>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'dropdown_single'">
                <div class="f-col mdo-form-field dropdown-single">
                    <mat-label>Value</mat-label>
                    <input matInput placeholder="Type to search" [formControl]="dropdownSearchCtrl" [matAutocomplete]="auto"/>
                    <mat-autocomplete class="mdo-autocomplete" #auto="matAutocomplete" (optionSelected)="selectSingle($event)">
                        <mat-option class="mdo-option" *ngFor="let opt of dropdownFilteredValues" [value]="opt.value">
                          {{ opt.value }}
                        </mat-option>
                    </mat-autocomplete>
                </div>
            </ng-container>
            <ng-container *ngIf="filterControlType === 'dropdown_multi'">
                <lib-chip-list class="mdo-chip-list">
                    <lib-chip [removable]="true" *ngFor="let field of dropdownSelectedChips" (click)="selectMulti(field.TEXT, 'remove')">{{ field.TEXT }}</lib-chip>
                </lib-chip-list>
                <div class="f-col mdo-form-field dropdown-multi">
                    <mat-label>Value</mat-label>
                    <input matInput placeholder="Type to search" [formControl]="dropdownSearchCtrl" [matAutocomplete]="auto"/>
                    <mat-autocomplete class="mdo-autocomplete" #auto="matAutocomplete" (optionSelected)="selectMulti($event, 'add')">
                        <mat-option class="mdo-option" *ngFor="let opt of dropdownFilteredValues" [value]="opt.TEXT">
                            {{ opt.TEXT }}
                        </mat-option>
                    </mat-autocomplete>
                </div>
            </ng-container>
        </div>
    </div>
</div>