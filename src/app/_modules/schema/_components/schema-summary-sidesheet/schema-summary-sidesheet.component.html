<mat-card class="root mat-elevation-z0">
    <div class="f-row breadcrum-toolbar">
        <button mat-button (click)="close()">
            <mat-icon fontSet="mdo-icons">close</mat-icon>
        </button>
        <div class="col-spacer"></div>
        <div class="f-row mdo-constrained-right">
            <div class="display-heading-large">
                {{schemaDetails?.moduleDescription ? schemaDetails.moduleDescription : 'Untitled'}} / {{schemaDetails?.schemaDescription ? schemaDetails.schemaDescription: 'Untitled'}}
            </div>
            <span class="f-col-spacer-half"></span>
            <!-- <button mat-button [matMenuTriggerFor]="check">
                <mat-icon fontSet="mdo-icons">menu-arrow</mat-icon>
            </button> -->

            <!-- <mat-menu #check="matMenu"> 
                <button mat-menu-item [matMenuTriggerFor]="customermenu">Customer</button>
                <button mat-menu-item>Material</button>
                <button mat-menu-item>Order</button>
                <button mat-menu-item>Vendor</button>
              </mat-menu>

              <mat-menu #customermenu="matMenu">
                <button mat-menu-item>Customer one</button>
                <button mat-menu-item>Customer two</button>
                <button mat-menu-item>Customer three</button>
                <button mat-menu-item>Customer four</button>
              </mat-menu> -->

            <span class="f-spacer"></span>
            <button mat-flat-button (click)="openUploadSideSheet()">
                <mat-icon fontSet="mdo-icons"> outbox-alt</mat-icon> Upload data
            </button>
                <span class="f-col-spacer-half"></span>
            <button mat-flat-button color="primary" (click)="saveCheckData()">Check</button>
        </div>
    </div>
    <div class="row-spacer"></div>
    <div class="f-col mdo-justify">
        <!-- <mat-card class="f-row mat-elevation-z0 message-alert">
            <mat-icon fontSet="mdo-icons" class="help-icon">question-mark</mat-icon>
            <span class="f-col-spacer-half"></span>
            <p>167 out of 77543 records will be validated based on your data scope selection</p>
        </mat-card> -->

        <div class="row-spacer"></div>

        <div class="f-col">
            <pros-form-input [type]="'text'" [label]="'Data scope'"></pros-form-input>
            <div class="row-spacer"></div>
            <div class="f-col temp-field">
                <mat-label>Threshold</mat-label>
                <mat-slider color="primary" [disabled]="false"
                            [value]="thresholdValue ? thresholdValue : 0"></mat-slider>
            </div>
            <div class="row-spacer"></div>
            <mat-accordion>
                <mat-expansion-panel togglePosition="before" class="mat-elevation-z0">
                    <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                        <mat-panel-title class="panel-title">
                            Business rules ({{businessRuleData ? businessRuleData.length : 0}})
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <!-- Business rule listing latest code start here-->
                    <div class="colunm-listing">
                        <div class="f-row colunm-box rule-border-row">
                            <div class="col"></div>
                            <div class="col col-x8"><strong>Business rule</strong></div>
                            <div class="col col-x8 text-center"><strong class="f-row">Weight
                                    <mat-icon matTooltip="Weight" fontSet="mdo-icons" class="mat-head-icon">
                                        question-mark</mat-icon>
                                </strong></div>
                            <div class="col col-x8"><strong>Enabled</strong></div>
                        </div>

                        <div class="f-row colunm-box rule-border-row">
                            <div class="mdo-auto-select">
                                <pros-form-input-autoselect [fieldLabel]="'Type rule name to add'" (openCustomDialog)="openBusinessRuleSideSheet()"
                                [updatedOptionsList]="allBusinessRulesList" [labelKey]="'brInfo'" (optionSelectedEmit)="addBusinessRule($event)"></pros-form-input-autoselect>
                            </div>
                        </div>

                        <div *ngFor="let businessRule of businessRuleData" class="f-row colunm-box rule-border-row">
                            <div class="col">
                                <!-- <button mat-button cdkDragHandle> -->
                                    <mat-icon fontSet="mdo-icons"> two-lines</mat-icon>
                                <!-- </button> -->
                            </div>

                            <div class="col col-x8">
                                <a class="f-row info-link">{{businessRule.brInfo}}</a>
                            </div>

                            <div class="col col-x8">
                                <mat-slider color="primary" [value]="businessRule.brWeightage" thumbLabel tickInterval="1"
                                min="0" [max]="availableWeightage(businessRule.brWeightage)" (change)="updateBr(businessRule,$event)">
                                </mat-slider>
                                <span class="f-col-spacer-half"></span>
                                <div>{{businessRule.brWeightage}}%</div>
                            </div>

                            <div class="col col-x8">
                                <mat-checkbox color="primary"  [checked]="businessRule.status === '1' ? true : false"
                                (change)="updateBr(businessRule,$event)"></mat-checkbox>
                                <span class="col-spacer"></span>
                                <span class="f-spacer"></span>
                                <button mat-button (click)="deleteBr(businessRule)">
                                    <mat-icon fontSet="mdo-icons"> recycle-bin</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Business rule listing latest code end here-->
                </mat-expansion-panel>
            </mat-accordion>

            <div class="row-spacer"></div>

            <mat-accordion>
                <mat-expansion-panel togglePosition="before" class="mat-elevation-z0">
                    <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                        <mat-panel-title class="panel-title">
                            Subscribers ({{subscriberData ? subscriberData.length : 0}})
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <!-- Subscribers listing latest code start here-->
                    <div class="colunm-listing">
                        <div class="f-row colunm-box rule-border-row">
                            <div class="col"></div>
                            <div class="col col-x8"><strong>Subscriber</strong></div>
                            <div class="col col-x4"><strong>Role</strong></div>
                            <div class="col col-x16"><strong>Data allocation</strong></div>
                            <div class="col mat-item-end">
                            </div>
                        </div>

                        <div class="f-row colunm-box rule-border-row">
                            <div class="mdo-auto-select">
                                <pros-form-input-autoselect [fieldLabel]="'Type subscriber name to add'"
                                (openCustomDialog)="openSubscriberSideSheet()" [updatedOptionsList]="allSubscribers"
                                [labelKey]="'fullName'" (optionSelectedEmit)="addSubscriber($event)"></pros-form-input-autoselect>
                            </div>
                        </div>

                        <div class="f-row colunm-box rule-border-row" *ngFor="let subscriber of subscriberData">
                            <div class="col">
                                <mat-card-header>
                                    <div mat-card-avatar *ngIf="subscriber.userMdoModel">
                                        {{shortName(subscriber.userMdoModel.fName, subscriber.userMdoModel.lName)}}
                                    </div>
                                </mat-card-header>
                            </div>

                            <div class="col col-x8">
                                <mat-card-header>
                                    <mat-card-title *ngIf="subscriber.userMdoModel!==undefined">
                                        {{subscriber.userMdoModel.fName}} {{subscriber.userMdoModel.lName}}
                                    </mat-card-title>
                                </mat-card-header>
                            </div>

                            <div class="col col-x4">
                                <button mat-stroked-button *ngIf="subscriber.isAdmin">Admin <mat-icon fontSet="mdo-icons">
                                    menu-arrow</mat-icon></button>
                            <button mat-stroked-button *ngIf="subscriber.isReviewer">Reviewer <mat-icon fontSet="mdo-icons">
                                menu-arrow</mat-icon></button>
                            <button mat-stroked-button *ngIf="subscriber.isViewer">Viewer <mat-icon fontSet="mdo-icons">
                                menu-arrow</mat-icon></button>
                            <button mat-stroked-button *ngIf="subscriber.isEditer">Editor <mat-icon fontSet="mdo-icons">
                                menu-arrow</mat-icon></button>
                            </div>

                            <div class="col col-x16">
                                <mat-chip-list>
                                    <ng-template ngFor let-ctrl [ngForOf]="subscriber.filterCriteria">
        
                                        <mat-chip class="mdo-filter-matchip" disableRipple="true"
                                            [matMenuTriggerFor]="appliedfiltermenu" (click)="loadDropValues(ctrl)">
                                            <label>
                                                {{ ctrl.fldCtrl ? ctrl.fldCtrl.fieldDescri : 'Unknown' }}
                                                :
                                            </label>
                                            <!-- <ng-template [ngIf]="ctrl.filterCtrl.selectedValues.length > 1"
                                                [ngIfElse]="showText"> -->
                                                <span class="info">
                                                    {{ prepareTextToShow(ctrl) }}
                                                </span>
                                            <!-- </ng-template> -->
                                            <!-- <ng-template #showText>
                                                <span class="info">
                                                    {{ prepareTextToShow(ctrl)}}
                                                </span>
                                            </ng-template> -->
                                            <mat-icon matChipRemove (click)="removeAppliedFilter(ctrl, subscriber.sno)">clear
                                            </mat-icon>
                                        </mat-chip>
                                    </ng-template>
        
                                    <mat-chip class="mdo-filter-matchip" disableRipple="true"
                                        [matMenuTriggerFor]="addfiltermenu" (click)="reInilize = !reInilize">
                                        <mat-icon fontSet="mdo-icons">folder-filter</mat-icon>
                                    </mat-chip>
        
                                </mat-chip-list>
        
                                <mat-menu #appliedfiltermenu="matMenu">
                                    <pros-filter-values [moduleId]="moduleId" (selectedValues)="fetchSelectedValues($event, subscriber.sno)"
                                        [fieldId]="loadDopValuesFor ? loadDopValuesFor.fieldId : ''"
                                        [checkedValue]="loadDopValuesFor ? loadDopValuesFor.checkedValue : []">
                                    </pros-filter-values>
                                </mat-menu>
        
                                <mat-menu #addfiltermenu="matMenu">
                                    <pros-add-filter-menu [moduleId]="moduleId"
                                        (evtReadyForApply)="makeFilterControl($event, subscriber.sno)" [reInilize]="reInilize">
                                    </pros-add-filter-menu>
                                </mat-menu>
                            </div>

                            <div class="col mat-item-end">
                                <button mat-button (click)="deleteSubscriber(subscriber.sno)">
                                    <mat-icon fontSet="mdo-icons"> recycle-bin</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Subscribers listing latest code end here -->
                </mat-expansion-panel>
            </mat-accordion>
        </div>
    </div>
</mat-card>