<div class="root">
    <div class="colunm-listing">
        <div class="f-row colunm-box rule-border-row">
            <div class="col col-x8"><strong>Fields</strong></div>
            <div class="col col-x8"><strong>Rule</strong></div>
            <div class="col"></div>
            <div class="col col-x16"><strong>Show result in</strong></div>
            <div class="col"></div>
        </div>
        <div class="f-row colunm-box rule-border-row">
            <div class="col">
                <mat-form-field appearance="outline">
                    <input matInput class="mat-input" [formControl]="availableField"
                        placeholder="Type field name to add" [matAutocomplete]="autoTarget" />
                    <mat-autocomplete #autoTarget="matAutocomplete" [displayWith]="displayFn.bind(this)"
                        (optionSelected)="selectCurrentField($event)">
                        <mat-option *ngFor="let fieldItem of filteredFields | async"
                            [value]="fieldItem.fieldId">
                            {{fieldItem.fieldDescri}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
        </div>
        <div>
            <pros-null-state [button]="null" [message]="'No fields selected, please select a field to continue'"
                *ngIf="selectedFields.length === 0"></pros-null-state>
            <div class="f-row colunm-box rule-border-row" *ngFor="let field of selectedFields;let i = index">
                <div class="col col-x8">
                    <div mat-line>{{getFieldLabel(field)}}</div>
                </div>

                <div class="col col-x8">
                    <pros-form-input [value]="getInputValue(getValue(i))" [type]="'text'" [placeholder]="'parameter...'"
                        [matMenuTriggerFor]="parameter" (menuOpened)="reload = !reload"></pros-form-input>
                    <mat-menu #parameter="matMenu" direction="center" class="mat-elevation-z0 tooltip-fields-menu">
                        <div class="top-tiparrow"></div>
                        <pros-lookup-config [reload]="reload" [availableModules]="modulesList" [initialData]="getValue(i)"
                            (saveData)="setLookupConfig($event, i)"></pros-lookup-config>
                    </mat-menu>
                </div>

                <div class="col">
                    <mat-icon fontSet="mdo-icons">arrow-right</mat-icon>
                </div>

                <div class="col col-x16">
                    <mat-form-field appearance="outline" class="divided-matfield">
                        <mat-select [value]="getValue(i, 'lookupTargetField')"
                            (selectionChange)="setLookupTargetField($event.value, i)">
                            <mat-option [value]="data.fieldId"
                                *ngFor="let data of fieldsObject.list">
                                {{data[fieldsObject.labelKey]}}
                            </mat-option>
                            <!-- <mat-option [value]="'New Field'">New Field</mat-option> -->
                        </mat-select>
                    </mat-form-field>

                    <span class="col-spacer"></span>
                    
                    <pros-form-input *ngIf="isEnabled(i) === true"
                        (valueChange)="setLookupTargetField($event, i, true)"
                        [value]="getValue(i, 'lookupTargetText')"
                        [type]="'text'"
                        [placeholder]="'Field name'" class="divided-matfield"></pros-form-input>
                </div>

                <div class="col text-end">
                    <button mat-button (click)="removeField(i)">
                        <mat-icon fontSet="mdo-icons">recycle-bin</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>