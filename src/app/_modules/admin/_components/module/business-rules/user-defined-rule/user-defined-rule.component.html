<div class="rulesfields">

    <!-- Business rule name / descriptions -->
    <mat-card class="mat-elevation-z3 pad0">
        <mat-toolbar>
            <mat-toolbar-row>
                <span>Business Rule</span>
            </mat-toolbar-row>
        </mat-toolbar>
        <div class="f-row">
            <mat-form-field class="rule-name">
                <mat-label>Business rule name</mat-label>
                <input matInput [formControl] ="udrDescFrmCtrl">
            </mat-form-field>
        </div>
    </mat-card>
    <div class="f-row-spacer-half"></div>


    <!-- conditional form fields -->
    <pros-udr-condition-form
    [schemaId]="schemaId"
    [moduleId]="moduleId"
    (evtAfterSaved) = "fetchConditionList($event)"
    ></pros-udr-condition-form>


    <mat-card class="mat-elevation-z3 condition-col">
        <mat-toolbar>
            <mat-toolbar-row>
                <span>Conditions List</span>
                <span class="f-spacer"></span>
                <button *ngIf="!expandPanel" mat-button color="primary" (click)="openAllPanels()">Expand All</button>
                <button *ngIf="expandPanel" mat-button color="primary" (click)="closeAllPanels()">Collapse All</button>
            </mat-toolbar-row>
        </mat-toolbar>
        <mat-card class="mat-elevation-z0">
            <div class="f-row">
                <mat-form-field class="rule-name">
                    <mat-label>Search block</mat-label>
                    <input matInput [formControl]="searchBlockCtrl">
                </mat-form-field>
            </div>

            <mat-accordion class="mat-elevation-z2" #accordion="matAccordion" [multi]="true">
                <mat-expansion-panel *ngFor="let list of conditionListOb | async">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{ list.blockDesc }}
                        </mat-panel-title>
                        <div class="f-spacer deleteBtn">
                            <button mat-button prosClickStopPropagation (click)="deleteCondition(list)" matTooltip="Delete">
                                <mat-icon>delete_outline</mat-icon>
                            </button>
                        </div>
                    </mat-expansion-panel-header>
                    <mat-panel-description>
                        <p> {{ prepareConditionDesc(list) }}</p>
                    </mat-panel-description>
                </mat-expansion-panel>
            </mat-accordion>
        </mat-card>
    </mat-card>

    <div class="selectedblock-col">
        <div *ngIf="enableBlock">
            <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
                <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
                    {{node.item}}
                </mat-tree-node>

                <mat-tree-node *matTreeNodeDef="let node; when: hasNoContent" matTreeNodePadding>
                    <pros-udr-condition-control
                    [condotionList]="conditionList"
                    [selectedBlocks] ="selectedBlocks[flatNodeMap.get(node).nodeId]"
                    (evtSelected) ="assignConBlocks($event, node, treeControl)">
                    </pros-udr-condition-control>
                </mat-tree-node>

                <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
                    <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.filename">
                        <mat-icon class="mat-icon-rtl-mirror">
                            {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                        </mat-icon>
                    </button>
                    <span class="textBold"> {{node.item}} </span>
                    <button class="and-button" mat-button color="primary" (click)="addNewItem(node, 'AND')">
                        Create And
                    </button>
                    <button class="or-button" mat-button color="primary" (click)="addNewItem(node, 'OR')">
                        Create OR
                    </button>

                </mat-tree-node>
            </mat-tree>

            <div class="finish-btn">
                <button mat-button color="warm" (click)="discard(null)">Back</button>
                <button mat-button color="primary" (click)="finishUdrProcess()">Finish Process</button>
            </div>
        </div>


        <div class="f-col nullstate" *ngIf="!enableBlock">
            <button mat-fab disabled>
                <mat-icon color="primary">filter_none</mat-icon>
            </button>
            <p>Create add/or block for condition apply. Then you can drap and drop and make more block for condition
                flieds
            </p>
            <div class="f-row">
                <button mat-button color="primary" (click)="createBlock('AND')">Create and block</button>
                <button mat-button color="primary" (click)="createBlock('OR')">Create or block</button>
            </div>
        </div>
    </div>
</div>
