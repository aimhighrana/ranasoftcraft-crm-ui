<h2 mat-dialog-title> Conditions config </h2>
<mat-divider></mat-divider>
<mat-dialog-content>
    <mat-card>
        <!-- <mat-card-subtitle> Fields configuration </mat-card-subtitle> -->

        <form [formGroup]="conditionsForm">
            <table mat-table [dataSource]="dataSource" formArrayName="conditions">
                <!-- Row definitions -->
                <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
                <tr mat-row *matRowDef="let row; let i = index; columns: displayColumns;"></tr>

                <!-- Column definitions -->
                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef> Action </th>
                    <td mat-cell *matCellDef="let row; let index = index; let isFirst = first" [formGroupName]="index">
                        <button mat-mini-fab color="primary" (click)="addCondition()" class="item">
                            <mat-icon>playlist_add</mat-icon>
                        </button>
                        <button mat-mini-fab *ngIf="!isFirst" color="primary" (click)="removeCondition()" class="item">
                            <mat-icon>delete</mat-icon>
                        </button>
                        <mat-form-field *ngIf="!isFirst" class="operator">
                            <mat-label>Row operator</mat-label>
                            <mat-select formControlName="rowOperator">
                                <mat-option value="&&"> And </mat-option>
                                <mat-option value="||"> Or </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </td>
                </ng-container>

                <ng-container matColumnDef="field">
                    <th mat-header-cell *matHeaderCellDef> Field </th>
                    <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                        <mat-form-field>
                            <mat-label>Field</mat-label>
                            <!-- (selectionChange)="fieldSelected($event, row)" -->
                            <mat-select formControlName="field">
                                <mat-option *ngFor="let field of workflowFields" [value]="field.id" #matOption
                                    (click)="fieldSelected(matOption.selected, field, row)"> {{field.label}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </td>
                </ng-container>

                <ng-container matColumnDef="operator">
                    <th mat-header-cell *matHeaderCellDef> Operator </th>
                    <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                        <mat-form-field>
                            <mat-label>Operator</mat-label>
                            <mat-select formControlName="operator">
                                <mat-option *ngFor="let op of getFieldOperators(row.value.field)" 
                                    [value]="op.value"> {{op.label}} </mat-option>
                                <!-- 
                                <mat-option value="=="> Equals </mat-option>
                                    <mat-option value="!="> Not Equal </mat-option>
                                <mat-option value="_contains_"> Contains </mat-option>
                                <mat-option value="_starts_with_"> Starts With </mat-option>
                                <mat-option value="_ends_with_"> Ends With </mat-option>
                                <mat-option value="_does_not_starts_with_"> Does Not Starts With </mat-option>
                                <mat-option value="_does_not_ends_with_"> Does Not Ends With </mat-option> -->
                            </mat-select>
                        </mat-form-field>
                    </td>
                </ng-container>

                <ng-container matColumnDef="value">
                    <th mat-header-cell *matHeaderCellDef> Value </th>
                    <td mat-cell *matCellDef="let row; let index = index" [formGroupName]="index">
                        <!-- <mat-form-field>
                    <mat-label> Value </mat-label>
                    <input matInput formControlName="value">
                </mat-form-field>
                {{ getFieldType (row.value.field).type }}
                -->

                        <ng-container [ngSwitch]="row.value.picklist">
                            <mat-form-field *ngSwitchCase="FIELD_TYPE.Input">
                                <mat-label> Value </mat-label>
                                <input matInput formControlName="value">
                            </mat-form-field>
                            <mat-form-field *ngSwitchCase="FIELD_TYPE.Select">
                                <mat-label> Select value </mat-label>
                                <mat-select matInput formControlName="value">
                                    <ng-container *ngIf="row.value.options">
                                        <mat-option *ngFor="let option of row.value.options" [value]="option.CODE">
                                            {{ option.TEXT }}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>
                            <mat-form-field *ngSwitchDefault>
                                <mat-label> Value </mat-label>
                                <input matInput formControlName="value">
                            </mat-form-field>
                        </ng-container>

                    </td>
                </ng-container>

            </table>
            <!-- <button type="button" (click)="addRow()">Add row</button> -->
        </form>
    </mat-card>
</mat-dialog-content>
<div mat-dialog-actions align="end">
    <button mat-button (click)="onCancelClick()">Cancel</button>
    <button mat-button [mat-dialog-close]="conditionsForm.value" cdkFocusInitial>Ok</button>
</div>