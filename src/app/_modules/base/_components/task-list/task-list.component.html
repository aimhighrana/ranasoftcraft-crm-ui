<div class="root">
    <mat-card class="container-show tasklist-container">

        <mat-tab-group #tabs>
            <!-- Tab content for My task -->
            <mat-tab label="My Task">
                <ng-container *ngTemplateOutlet="commonFilterContent"></ng-container>
                <div class="f-row list-wrapper">
                    <div class="tasks-container" [class.content-row]="!selectedTaskId" [class.split]="selectedTaskId"
                        [summaryShown]="enableDragging.asObservable()" prosResizeable>

                        <!-- dynamic column -->
                        <pros-columnsetting [tableColumns]="tableColumns" (updateColumns)="updateColumns($event)"
                            (close)="toggleColumnSettingPopUp()" *ngIf="showColumnSettingPopUp">
                        </pros-columnsetting>
                        <ng-container *ngTemplateOutlet="commonTableComponent"></ng-container>

                        <div class="hand-control"></div>

                    </div>
                    <ng-container *ngTemplateOutlet="commonDetailsContent"></ng-container>
                </div>
            </mat-tab>
            <!-- Tab content for My task ends -->

            <!-- Tab content for In WorkFlow -->
            <mat-tab label="In Workflow">
                <ng-container *ngTemplateOutlet="commonFilterContent"></ng-container>
                <div class="f-row list-wrapper">

                    <div class="tasks-container" [class.content-row]="!selectedTaskId" [class.split]="selectedTaskId"
                        [summaryShown]="enableDragging.asObservable()" prosResizeable>
                        <button mat-icon-button class="ac-setting" color="primary"
                            (click)="showColumnSettingPopUp=!showColumnSettingPopUp">
                            <mat-icon matTooltip="Colunm Setting">settings</mat-icon>
                        </button>

                        <!-- <pros-columnsetting [tableColumns]="tableColumns" (updateColumns)="updateColumns($event)"
                            (close)="toggleColumnSettingPopUp()" *ngIf="showColumnSettingPopUp">
                        </pros-columnsetting> -->

                        <div class="hand-control"></div>
                        <ng-container *ngTemplateOutlet="commonTableComponent"></ng-container>

                    </div>
                    <ng-container *ngTemplateOutlet="commonDetailsContent"></ng-container>
                </div>
            </mat-tab>
            <!-- Tab content for In WorkFlow ends-->

            <!-- Tab content for Completed -->
            <mat-tab label="Completed">
                <ng-container *ngTemplateOutlet="commonFilterContent"></ng-container>
                <div class="f-row list-wrapper">
                    <div class="tasks-container" [class.content-row]="!selectedTaskId" [class.split]="selectedTaskId"
                        [summaryShown]="enableDragging.asObservable()" prosResizeable>
                        <button mat-icon-button class="ac-setting" color="primary"
                            (click)="showColumnSettingPopUp=!showColumnSettingPopUp">
                            <mat-icon matTooltip="Colunm Setting">settings</mat-icon>
                        </button>

                        <!-- <pros-columnsetting [tableColumns]="tableColumns" (updateColumns)="updateColumns($event)"
                            (close)="toggleColumnSettingPopUp()" *ngIf="showColumnSettingPopUp">
                        </pros-columnsetting> -->

                        <div class="hand-control"></div>

                        <ng-container *ngTemplateOutlet="commonTableComponent"></ng-container>

                    </div>
                    <ng-container *ngTemplateOutlet="commonDetailsContent"></ng-container>
                </div>
            </mat-tab>
            <!-- Tab content for Completed ends -->
        </mat-tab-group>

        <!-- common template for filter -->
        <ng-template #commonFilterContent>
            <div class="f-row search-action">
                <mat-form-field appearance="outline">
                    <mat-icon matSuffix>search</mat-icon>
                    <mat-label>Search</mat-label>
                    <input matInput (keyup)="doWildSearch($event)" placeholder="Placeholder">
                </mat-form-field>
                <span class="col-spacer"></span>
                <button mat-stroked-button color="primary" (click)="getFilters()">
                    <mat-icon matSuffix>filter_list</mat-icon>Filters
                </button>
                <span class="f-spacer"></span>
                <button mat-button color="primary">
                    <mat-icon>star_border</mat-icon>Save search
                </button>
                <span class="col-spacer"></span>
                <button mat-button color="primary" [matMenuTriggerFor]="menu">Saved searches<mat-icon>
                        keyboard_arrow_down</mat-icon></button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item *ngFor="let savedSearch of savedSearches">{{savedSearch.searchName}}</button>
                </mat-menu>
            </div>
            <div class="f-row action-list">
                <p class="mat-label" *ngIf="wildSearchEnabled"> {{dataSource.data.length}} results found for
                    "{{wildSearchValue}}"</p>
                <span class="f-spacer"></span>
                <mat-paginator [length]="100" [pageSize]="10" [pageSizeOptions]="[10, 20, 50, 100]" (page)="paginate($event)"></mat-paginator>
            </div>

            <!--  filters -->
            <pros-filters-dropdown [filterObservable]="filterEmitter.asObservable()" [selectedFields]="filterForm.controls.filtersMap.value" *ngIf="dynamicFiltersVisible"
                (closeFilterBox)="closeFilters()" (updateFilters)="updateFilters($event)">
            </pros-filters-dropdown>

        </ng-template>

        <!-- common template for tables -->
        <ng-template #commonTableComponent>
            <mat-table #table [dataSource]="dataSource" matSort  (matSortChange)="sortData($event)">

                <ng-container matColumnDef="taskid">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Task ID </mat-header-cell>
                    <mat-cell *matCellDef="let element" (click)="getTaskDetails(element.taskid)" class="taskid-link">
                        <span class="mat-text">{{element.taskid}}</span>
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="emailtext">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Description </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        <span class="mat-text">
                            {{element.emailtext}}
                        </span>
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="requestorName">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Requested By </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        <mat-icon class="user-icon">account_circle</mat-icon> {{element.requestorName}}
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="datestarted">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Requested on </mat-header-cell>
                    <mat-cell *matCellDef="let element">{{element.datestarted | date: 'dd/MM/yyyy hh:mm'}}
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="duedate">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Due Date </mat-header-cell>
                    <mat-cell *matCellDef="let element"> {{element.duedate | date:'dd/MM/yyyy hh:mm'}}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="fname">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Sender </mat-header-cell>
                    <mat-cell *matCellDef="let element"> {{element.fname}}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="objectdesc">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Module </mat-header-cell>
                    <mat-cell *matCellDef="let element"> {{element.objectdesc}}</mat-cell>
                </ng-container>

                <ng-container matColumnDef="priorityType">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Priority </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                        <select matNativeControl [(ngModel)]="element.priorityType" class="dropdown-fields">
                            <option value="STATIC">Static</option>
                            <option value="MEDIUM">Medium</option>
                            <option value="mercedes">Low</option>
                          </select>
                          <mat-icon>arrow_drop_down</mat-icon>
                        <!-- <button mat-button>{{element.priorityType}} <mat-icon>arrow_drop_down</mat-icon>
                        </button> -->
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="tags">
                    <mat-header-cell *matHeaderCellDef mat-sort-header> Tags </mat-header-cell>
                    <mat-cell *matCellDef="let element" [attr.colspan]="2">
                        <mat-chip-list [tags]="element.tags" prosTagsEllipsis>                          
                        </mat-chip-list>
                        <!-- <a class="additiontags">+1</a> -->
                    </mat-cell>
                </ng-container>

                <ng-container matColumnDef="setting">
                    <mat-header-cell *matHeaderCellDef>
                        <button mat-icon-button class="ac-setting" color="primary"
                        (click)="showColumnSettingPopUp=!showColumnSettingPopUp">
                        <mat-icon matTooltip="Colunm Setting" >settings</mat-icon>
                    </button>

                    </mat-header-cell>
                    <mat-cell *matCellDef="let element">
                    </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="getDisplayColumns;sticky:true"></mat-header-row>
                <mat-row *matRowDef="let row; columns: getDisplayColumns;"></mat-row>
            </mat-table>
        </ng-template>

        <!-- common template for details -->
        <ng-template #commonDetailsContent>
            <div *ngIf="showTaskDetails" class="split-container">
                <pros-task-summary [currentTab]="activeTab" [taskId]="selectedTaskId"
                    (closeDetails)="closeDetailsModal($event)">
                </pros-task-summary>
            </div>
        </ng-template>
    </mat-card>
</div>