<mat-card class="mat-elevation-z0 root">
    <div class="f-row breadcrum-toolbar">
        <div class="display-heading-large">
            Dashboard builder
        </div>
        <div class="f-spacer"></div>

        <button mat-flat-button color="accent" (click)="createUpdateReport()"> Save </button>
        <button mat-fab color="accent" class="mat-elevation-z0" *ngIf="collaboratorPermission && reportId"
            [routerLink]="['', { outlets: { sb: 'sb/report/collaborators/' + reportId } } ]">
            <mat-icon>group_add</mat-icon>
        </button>
       
    </div>

    <div class="row-spacer"></div>

    <div class="f-col report-builder">
        <pros-form-input [type]="'text'" [placeholder]="'Untitled-1'" [label]="'Dashboard name'" [value]="reportName"
          [maxLength]="maxReportNameLength"  (valueChange)="(setreportname($event))">
        </pros-form-input>

        <div class="f-row builder-container">
            <div class="widget-col">
                <div class="col-heading">Widgets</div>
                <div cdkDropList cdkDropListConnectedTo="container">
                    <div cdkDrag cdkDragHandle widgetType="FILTER" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">filter</mat-icon> Filter
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="COUNT" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">form-number</mat-icon> Metric
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="TABLE_LIST" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">form-table</mat-icon> Table list
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="BAR_CHART" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">chart-pie</mat-icon> Bar/pie chart
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="STACKED_BAR_CHART" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">chart-complex</mat-icon> Stacked bar
                        chart
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="IMAGE" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">picture</mat-icon> Image
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="HTML" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">more-alt2</mat-icon> HTML editor
                    </div>
                    <mat-divider></mat-divider>
                    <div cdkDrag cdkDragHandle widgetType="TIMESERIES" class="widget-drag">
                        <mat-icon fontSet="mdo-icons" class="widget-icon">form-time</mat-icon> Time series
                    </div>
                    <mat-divider></mat-divider>
                </div>
            </div>

            <mat-card class="mat-elevation-z0 container-show builder-board" [ngStyle]="containerCss"
                [class.adjust-property]="showProperty" id="container" cdkDragBoundary cdkDropList
                (cdkDropListDropped)="drop($event)">
                <ng-template ngFor let-widget [ngForOf]="widgetList">
                    <pros-dynamic-widget [widget]="widget" [boxSize]="eachBoxSize" (evtDelete)="delete($event)"
                        (evtStyle)="showStyle($event)">
                    </pros-dynamic-widget>
                </ng-template>
            </mat-card>


            <div class="property-col" *ngIf="showProperty">
                <div class="f-row col-heading">
                    <div class="display-heading-large">
                        {{ selStyleWid ? selStyleWid.widgetTitle : 'Untitled' }} properties
                    </div>
                    <div class="f-spacer"></div>
                    <button mat-button (click)="showProperty=false">
                        <mat-icon>clear</mat-icon>
                    </button>
                </div>

                <!-- BASIC CONFIGURATION-->
                <mat-accordion>
                    <mat-expansion-panel class="mat-elevation-z0" togglePosition="before" expanded="true">
                        <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                            <mat-panel-title>
                                Basic configuration
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="f-col fields-col" [formGroup]="styleCtrlGrp">
                            <div class="f-col">
                                <mat-label>Widget name</mat-label>
                                <mat-form-field appearance="outline">
                                    <input matInput formControlName="widgetName" maxlength=100>
                                </mat-form-field>
                            </div>

                            <div class="f-row">
                                <div class="f-col">
                                    <mat-label>Width</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input type="number" max="pixcel" min="1" matInput formControlName="width" (keyup)="widthCount($event)">
                                    </mat-form-field>
                                </div>
                                <span class="col-spacer"></span>
                                <div class="f-col">
                                    <mat-label>Height</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input type="number" min="0" matInput formControlName="height" (keyup)="heightCount($event)">
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="f-col">
                                <ng-template [ngIf]="styleCtrlGrp.get('isWorkflowdataSet') && styleCtrlGrp.get('isWorkflowdataSet').value" [ngIfElse]="singleSelect">
                                    <mat-label>Data set ({{ styleCtrlGrp.get('objectType').value.split(',').length }} selected) </mat-label>
                                </ng-template>
                                <ng-template #singleSelect>
                                    <mat-label>Data set</mat-label>
                                </ng-template>
                                <mat-form-field appearance="outline">
                                    <input matInput [formControl]="objectType" [matAutocomplete]="dataSetCtrl" (keyup)="searchDataSet($event.target.value)" id="dataSets" >
                                    <mat-autocomplete #dataSetCtrl="matAutocomplete" [displayWith]="displayWithDataSet">
                                        <mat-optgroup label="Module">
                                            <mat-option *ngFor="let object of dataSetOb | async" [value]="object" (click)="afterDataSetSelect(object)">
                                                {{ object.objectdesc ? object.objectdesc : 'Untitled' }}
                                            </mat-option>
                                        </mat-optgroup>

                                        <pros-workflow-dataset (selectedWfs)="afterWfSelect($event)" [preSelectedObj]="selStyleWid ? selStyleWid.objectType : ''" [isWorkFlow]="isWorkflowRefresh" [searchText]="searchDataSetVal"></pros-workflow-dataset>                                        
                                    </mat-autocomplete>
                                </mat-form-field>
                                
                                <mat-hint *ngIf="selStyleWid  && selStyleWid.objectType && recordsCount">Total
                                    {{ recordsCount }} record(s) found</mat-hint>
                                <mat-hint *ngIf="selStyleWid  && selStyleWid.objectType && !recordsCount">Index not
                                    found , please sync data</mat-hint>
                            </div>

                            <div class="f-col">
                                <!-- <For WorkFlow Path> -->
                                <ng-template
                                    [ngIf]="styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===true">
                                    <mat-label>Workflow path</mat-label>
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="workflowPath" multiple>
                                            <mat-option *ngFor="let workflow of workflowPathOb | async" [value]="workflow.pathname">
                                                {{ workflow.workflowdesc ? workflow.workflowdesc : 'Unknown path' }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!-- FOR Aggregration -->
                                <ng-template
                                    [ngIf]="selStyleWid  && (selStyleWid.widgetType === 'COUNT' || selStyleWid.widgetType === 'BAR_CHART' || selStyleWid.widgetType === 'STACKED_BAR_CHART' || selStyleWid.widgetType === 'TIMESERIES') ">
                                    <mat-label>Aggregration operator</mat-label>
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="aggregrationOp">
                                            <mat-option value="GROUPBY">Group by</mat-option>
                                            <mat-option value="COUNT">Count</mat-option>
                                            <mat-option value="MIN">Min</mat-option>
                                            <mat-option value="MAX">Max</mat-option>
                                            <mat-option value="SUM">Sum</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!--Modules-->
                                <ng-template
                                    [ngIf]="selStyleWid && (selStyleWid.widgetType === 'COUNT' || selStyleWid.widgetType === 'BAR_CHART' || selStyleWid.widgetType === 'STACKED_BAR_CHART' || selStyleWid.widgetType === 'FILTER'  || selStyleWid.widgetType === 'TIMESERIES') && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===false">
                                    <pros-metadatafield-control [moduleId]="selStyleWid && selStyleWid.objectType"
                                        lebel="Field" [selectedFldId]="selStyleWid && selStyleWid.field"
                                        (selectionChange)='onFieldChange($event)'>
                                    </pros-metadatafield-control>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!-- FOR STACKED BAR CHART WIDGET-->
                                <ng-template
                                    [ngIf]="selStyleWid && (selStyleWid.widgetType === 'STACKED_BAR_CHART'  || selStyleWid.widgetType === 'TIMESERIES') && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===false">
                                    <pros-metadatafield-control [moduleId]="selStyleWid && selStyleWid.objectType"
                                        lebel="Group(s) with" [selectedFldId]="selStyleWid && selStyleWid.groupById"
                                        (selectionChange)='onGroupByChange($event)'>
                                    </pros-metadatafield-control>
                                </ng-template>

                                <!-- FOR STACKED BAR CHART WIDGET-->
                                <ng-template
                                    [ngIf]="selStyleWid && (selStyleWid.widgetType === 'STACKED_BAR_CHART'|| selStyleWid.widgetType === 'TIMESERIES') && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===true">
                                    <pros-workflowfield-control [objectType]="selStyleWid && selStyleWid.objectType"
                                        label="Group with(s)" [selectedFldId]="selStyleWid && selStyleWid.groupById"
                                        (selectionChange)='onGroupByChange($event)'>
                                    </pros-workflowfield-control>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!--WorkflowType-->
                                <ng-template
                                    [ngIf]="selStyleWid && (selStyleWid.widgetType === 'COUNT' || selStyleWid.widgetType === 'BAR_CHART' || selStyleWid.widgetType === 'STACKED_BAR_CHART' || selStyleWid.widgetType === 'FILTER' || selStyleWid.widgetType === 'TIMESERIES') && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===true">
                                    <pros-workflowfield-control [objectType]="selStyleWid && selStyleWid.objectType"
                                        label="Field" [selectedFldId]="selStyleWid && selStyleWid.field"
                                        (selectionChange)='onFieldChange($event)'>
                                    </pros-workflowfield-control>
                                </ng-template>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid && selStyleWid.widgetType === 'TIMESERIES'">
                                <!--WorkflowType-->
                                <pros-workflowfield-control [objectType]="selStyleWid && selStyleWid.objectType"
                                        label="Distinct with" [selectedFldId]="selStyleWid && selStyleWid.distictWith"
                                        (selectionChange)='onDistictWithChange($event)'>
                                </pros-workflowfield-control>
                            </div>

                            <div class="f-col">
                                <!-- FOR FILTERs WIDGET-->
                                <ng-template [ngIf]="selStyleWid && selStyleWid.widgetType === 'FILTER' ">
                                    <!-- if date type field then , special config -->
                                    <ng-template
                                        [ngIf]="selStyleWid.fieldCtrl && selStyleWid.fieldCtrl.picklist === '0' && (selStyleWid.fieldCtrl.dataType === 'DTMS' || selStyleWid.fieldCtrl.dataType === 'DATS')"
                                        [ngIfElse]="otherCtrl">

                                        <div class="f-col">
                                            <mat-label>Select date</mat-label>
                                            <mat-form-field appearance="outline">
                                                <mat-select formControlName="dateSelectionType">
                                                    <mat-option>
                                                        No date
                                                    </mat-option>
                                                    <mat-option value="TODAY">
                                                        Today
                                                    </mat-option>
                                                    <mat-option value="DAY_7">
                                                        7 days
                                                    </mat-option>
                                                    <mat-option value="DAY_10">
                                                        10 days
                                                    </mat-option>
                                                    <mat-option value="DAY_20">
                                                        20 days
                                                    </mat-option>
                                                    <mat-option value="DAY_30">
                                                        30 days
                                                    </mat-option>
                                                    <mat-option value="CUSTOM">Custom date</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                        <div class="f-col">
                                            <div class="f-row">
                                                <!-- when user choose custom date then start and end date should appear -->
                                                <ng-template
                                                    [ngIf]="styleCtrlGrp && styleCtrlGrp.get('dateSelectionType').value === 'CUSTOM'">
                                                    <div class="f-col">
                                                        <mat-label>Start date</mat-label>
                                                        <mat-form-field appearance="outline">
                                                            <input matInput matInput [matDatepicker]="startDate"
                                                                disabled formControlName="startDate">
                                                                <div class="f-row input-actions">
                                                                    <mat-divider [vertical]="true"></mat-divider>
                                                                    <mat-datepicker-toggle matSuffix [for]="startDate">
                                                                    </mat-datepicker-toggle>
                                                                    <mat-datepicker #startDate disabled="false">
                                                                    </mat-datepicker>
                                                                </div>
                                                           
                                                        </mat-form-field>
                                                    </div>

                                                    <span class="col-spacer"></span>

                                                    <div class="f-col">
                                                        <mat-label>End date</mat-label>
                                                        <mat-form-field appearance="outline">
                                                            <input matInput matInput [matDatepicker]="endDate" disabled
                                                                formControlName="endDate">
                                                                <div class="f-row input-actions">
                                                                    <mat-divider [vertical]="true"></mat-divider>
                                                                    <mat-datepicker-toggle matSuffix [for]="endDate">
                                                                    </mat-datepicker-toggle>
                                                                    <mat-datepicker #endDate disabled="false">
                                                                    </mat-datepicker>
                                                                  </div>
                                                        </mat-form-field>
                                                    </div>
                                                </ng-template>
                                            </div>
                                        </div>
                                    </ng-template>

                                    <ng-template #otherCtrl>
                                        <div class="f-col">
                                            <mat-label>Filter type</mat-label>
                                            <mat-form-field appearance="outline">
                                                <mat-select formControlName="filterType">
                                                    <mat-option value="DROPDOWN_VALS">Dropdown value</mat-option>
                                                    <mat-option value="HORIZONTAL_VALS">Horizontal value</mat-option>
                                                    <mat-option value="VERTICAL_VALS">Vertical value</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                        <div class="f-col">
                                            <mat-checkbox color="primary" formControlName="isMultiSelect">Is
                                                multiselect
                                            </mat-checkbox>
                                        </div>
                                    </ng-template>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!-- FOR TABLE LIST CHOOSE COLUMNS WIDGET-->
                                <ng-template
                                    [ngIf]="selStyleWid && selStyleWid.widgetType === 'TABLE_LIST' && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===false">
                                    <mat-label>Choose columns</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input matInput [matAutocomplete]="chooseColumn" (keyup)="searchChooseColumn($event.target.value)">
                                        <mat-autocomplete #chooseColumn="matAutocomplete" [displayWith]="chooseColumnDisWith">
                                            <mat-option *ngFor="let field of headerFields | async"
                                                value="{{ field.fieldId }}">
                                                <div (click)="optionClicked($event, field)">
                                                    <mat-checkbox prosClickStopPropagation
                                                        (change)="toggleSelection(field)" [checked]="isSelected(field)"
                                                        color="primary">
                                                        {{ field.fieldDescri }}
                                                    </mat-checkbox>
                                                </div>
                                            </mat-option>
                                        </mat-autocomplete>

                                    </mat-form-field>
                                    <mat-hint>{{ chooseColumns ? chooseColumns.length : '0' }} Selected</mat-hint>
                                </ng-template>

                                <ng-template
                                    [ngIf]="selStyleWid && selStyleWid.widgetType === 'TABLE_LIST' && styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===true">
                                    <mat-label>Choose columns</mat-label>
                                    <mat-form-field appearance="outline">

                                        <input matInput [matAutocomplete]="chooseColumnWF" (keyup)="searchChooseColumnWorkflow($event.target.value)">
                                        <mat-autocomplete #chooseColumnWF="matAutocomplete" [displayWith]="chooseColumnDisWith">
                                            <mat-optgroup label="System fileds">
                                                <mat-option *ngFor="let field of (workflowFieldsObs | async).static"
                                                value="{{ field.fieldId }}">
                                                <div (click)="optionClicked($event, field)">
                                                    <mat-checkbox prosClickStopPropagation
                                                        (change)="toggleSelection(field)" [checked]="isSelected(field)"
                                                        color="primary">
                                                        {{ field.fieldDescri }}
                                                    </mat-checkbox>
                                                </div>
                                               </mat-option>
                                            </mat-optgroup>

                                            <mat-optgroup label="Module fileds">
                                                <mat-option *ngFor="let field of (workflowFieldsObs | async).dynamic"
                                                value="{{ field.fieldId }}">
                                                <div (click)="optionClicked($event, field)">
                                                    <mat-checkbox prosClickStopPropagation
                                                        (change)="toggleSelection(field)" [checked]="isSelected(field)"
                                                        color="primary">
                                                        {{ field.fieldDescri }}
                                                    </mat-checkbox>
                                                </div>
                                               </mat-option>
                                            </mat-optgroup>
                                        </mat-autocomplete> 
                                         
                                    </mat-form-field>
                                    <mat-hint>{{ chooseColumns ? chooseColumns.length : '0' }} Selected</mat-hint>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!-- FOR IMAGE WIDGET-->
                                <ng-template [ngIf]="selStyleWid && selStyleWid.widgetType === 'IMAGE'">
                                    <mat-label>Image link</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input matInput formControlName="imageUrl">
                                    </mat-form-field>

                                    <div class="f-row image-algin">
                                        <button mat-button matTooltip="Upload image"
                                            (click)="uploadFileChange()">
                                            <mat-icon>add_photo_alternate</mat-icon>
                                        </button>
                                        <input type="file" (change)="fileChange($event)" style="display: none;"
                                            multiple="false" id="uploadFileCtrl" accept="image/png, image/jpeg" />
                                        <span class="col-spacer"></span>
                                        <mat-form-field class="upload-mat-form" appearance="outline">
                                            <input matInput disabled readonly formControlName="imageName">
                                            <div class="f-row input-actions">
                                                <mat-divider [vertical]="true"></mat-divider>
                                                <button mat-button matSuffix aria-label="Clear"
                                                (click)="removeUploadedImage()">
                                                <mat-icon>close</mat-icon>
                                            </button>
                                              </div>
                                        </mat-form-field>
                                    </div>
                                </ng-template>
                            </div>

                            <div class="f-col">
                                <!-- FOR IMAGE WIDGET-->
                                <ng-template [ngIf]="selStyleWid && selStyleWid.widgetType === 'HTML'">
                                    <mat-label>HTML content</mat-label>
                                    <mat-form-field appearance="outline">
                                        <textarea matInput placeholder="Write html text.."
                                            formControlName="htmlText"></textarea>
                                    </mat-form-field>
                                </ng-template>
                            </div>
                        </div>
                    </mat-expansion-panel>
                </mat-accordion>

                <!-- CHART PROPERTIES -->
                <mat-accordion
                    *ngIf="selStyleWid  && (selStyleWid.widgetType === 'BAR_CHART' || selStyleWid.widgetType === 'STACKED_BAR_CHART' || selStyleWid.widgetType === 'TIMESERIES') ">
                    <mat-expansion-panel class="mat-elevation-z0" togglePosition="before" expanded="true">
                        <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                            <mat-panel-title>
                                Chart properties
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="f-col fields-col" [formGroup]="chartPropCtrlGrp">
                            <div class="f-col">
                                <mat-label>Chart type </mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="chartType">
                                        <mat-option value="BAR"> Bar </mat-option>
                                        <mat-option *ngIf="selStyleWid.widgetType === 'BAR_CHART' " value="PIE"> Pie
                                        </mat-option>
                                        <mat-option *ngIf="selStyleWid.widgetType === 'TIMESERIES' " value="LINE"> Line
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="f-col"  *ngIf="selStyleWid.widgetType !== 'TIMESERIES'">
                                <mat-label>Orientation</mat-label>
                                <mat-form-field appearance="outline"
                                    *ngIf="chartPropCtrlGrp && chartPropCtrlGrp.get('chartType').value === 'BAR'">
                                    <mat-select formControlName="orientation">
                                        <mat-option value="VERTICAL"> Vertical </mat-option>
                                        <mat-option value="HORIZONTAL"> Horizontal </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <ng-template
                                [ngIf]="chartPropCtrlGrp && chartPropCtrlGrp.get('chartType').value === 'BAR' || chartPropCtrlGrp.get('chartType').value === 'LINE'">
                                <div class="f-col">
                                    <mat-label>X-axis label</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input matInput formControlName="xAxisLabel">
                                    </mat-form-field>
                                </div>

                                <div class="f-col">
                                    <mat-label>Y-axis label</mat-label>
                                    <mat-form-field appearance="outline">
                                        <input matInput formControlName="yAxisLabel">
                                    </mat-form-field>
                                </div>

                                <div class="f-col" *ngIf="selStyleWid.widgetType !== 'TIMESERIES'">
                                    <mat-label>Count order by</mat-label>
                                    <mat-form-field appearance="outline">
                                        <mat-select formControlName="orderWith">
                                            <mat-option value="asc"> Ascending </mat-option>
                                            <mat-option value="desc"> Descending </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div class="f-col">
                                    <div class="f-row">
                                        <div class="f-col">
                                            <mat-label>Scale from</mat-label>
                                            <mat-form-field appearance="outline">
                                                <input type="number" min="0" matInput formControlName="scaleFrom">
                                            </mat-form-field>
                                        </div>
                                        <span class="col-spacer"></span>
                                        <div class="f-col">
                                            <mat-label>Scale to</mat-label>
                                            <mat-form-field appearance="outline">
                                                <input type="number" min="0" matInput formControlName="scaleTo">
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>

                                <div class="f-col">
                                    <div class="f-row">
                                        <div class="f-col">
                                            <mat-label>Scale step size</mat-label>
                                            <mat-form-field appearance="outline">
                                                <input type="number" min="0" matInput formControlName="stepSize">
                                            </mat-form-field>
                                        </div>
                                        <span class="col-spacer"></span>
                                        <div class="f-col">
                                            <mat-label>Max dataset number</mat-label>
                                            <mat-form-field appearance="outline">
                                                <input type="number" min="0" matInput formControlName="dataSetSize">
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                            </ng-template>

                            <div class="f-col">
                                <mat-checkbox color="primary" formControlName="isEnableDatalabels">Enable datalabels
                                </mat-checkbox>
                            </div>

                            <div class="f-col"
                                *ngIf="chartPropCtrlGrp && chartPropCtrlGrp.get('isEnableDatalabels').value && chartPropCtrlGrp.get('chartType').value !== 'PIE'">
                                <mat-label>Datalabels position</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="datalabelsPosition">
                                        <mat-option value="center">Center </mat-option>
                                        <mat-option value="start">Start </mat-option>
                                        <mat-option value="end">End </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <!-- PIE CHART PERCETAGE CONFIG -->
                            <div class="f-col" *ngIf="chartPropCtrlGrp && chartPropCtrlGrp.get('isEnableDatalabels').value && ( chartPropCtrlGrp.get('chartType').value === 'PIE' || (selStyleWid && selStyleWid.widgetType === 'TIMESERIES' &&  selStyleWid.field === 'TIME_TAKEN') )">
                                <mat-checkbox color="primary" formControlName="isEnabledBarPerc">Show data in %
                                </mat-checkbox>
                            </div>
                                <!-- PIE CHART PERCETAGE CONFIG -->

                            <div class="f-col">
                                <mat-checkbox color="primary" formControlName="isEnableLegend">Show legend
                                </mat-checkbox>
                            </div>

                            <div class="f-col" *ngIf="chartPropCtrlGrp && chartPropCtrlGrp.get('isEnableLegend').value">
                                <mat-label>Legend position</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="legendPosition">
                                        <mat-option value="top"> Top </mat-option>
                                        <mat-option value="left"> Left </mat-option>
                                        <mat-option value="bottom"> Bottom </mat-option>
                                        <mat-option value="right"> Right </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid.widgetType !== 'TIMESERIES'">
                                <mat-label>Default value alias</mat-label>
                                <mat-form-field appearance="outline">
                                    <input matInput formControlName="blankValueAlias">
                                </mat-form-field>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid.widgetType === 'TIMESERIES'">
                                <!-- SERIES WITH -->
                                <mat-label>Series with</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="seriesWith">
                                        <mat-option value="millisecond"> Millisecond </mat-option>
                                        <mat-option value="second"> Second </mat-option>
                                        <mat-option value="minute"> Minute </mat-option>
                                        <mat-option value="hour"> Hour </mat-option>
                                        <mat-option value="day"> Day </mat-option>
                                        <mat-option value="week"> Week </mat-option>
                                        <mat-option value="month"> Month </mat-option>
                                        <mat-option value="quarter"> Quarter </mat-option>
                                        <mat-option value="year"> Year </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid.widgetType === 'TIMESERIES'">
                                <!-- SERIES FORMAT -->
                                <mat-label>Series format</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="seriesFormat">
                                        <mat-option value="MMM-dd-yy">MMM-dd-yy</mat-option>
                                        <mat-option value="dd-MMM-yy">dd-MMM-yy</mat-option>
                                        <mat-option value="dd MMM, yy">dd MMM, yy</mat-option>
                                        <mat-option value="MMM d, yy">MMM d, yy</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid.widgetType === 'TIMESERIES'">
                                <!-- DATE RANGE FOR TIME SERIES -->
                                <mat-label>Select interval</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="timeseriesStartDate">
                                        <mat-option value="millisecond"> Today </mat-option>
                                        <mat-option value="7"> 7 </mat-option>
                                        <mat-option value="10"> 10 </mat-option>
                                        <mat-option value="20"> 20 </mat-option>
                                        <mat-option value="30"> 30 </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="f-col" *ngIf="selStyleWid && selStyleWid.widgetType === 'TIMESERIES' &&  selStyleWid.field === 'TIME_TAKEN'">
                                <mat-label>Bucket filter</mat-label>
                                <mat-form-field appearance="outline">
                                    <mat-select formControlName="bucketFilter">
                                        <mat-option value=""> No filter </mat-option>
                                        <mat-option value="less_then_1_day"> Less then a day </mat-option>
                                        <mat-option value="within_1_day"> Within a day </mat-option>
                                        <mat-option value="more_then_1_day"> More then a day </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>



                        </div>
                    </mat-expansion-panel>
                </mat-accordion>

                <!-- DEFAULT FILTERS -->
                <mat-accordion *ngIf="selStyleWid && selStyleWid.fieldCtrl && !(selStyleWid.fieldCtrl.dataType === 'DTMS' || selStyleWid.fieldCtrl.dataType === 'DATS')">
                    <mat-expansion-panel class="mat-elevation-z0" togglePosition="before" expanded="true">
                        <mat-expansion-panel-header expandedHeight="48px" collapsedHeight="48px">
                            <mat-panel-title>
                                Default filters
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="f-col fields-col">
                            <ng-template [ngIf]="selStyleWid  && selStyleWid.defaultFilters">
                                <div [formGroup]="defaultFilterCtrlGrp">
                                    <div class="f-row def-algin" formArrayName="filters"
                                        *ngFor="let filter of defaultFilterCtrlGrp.get('filters').controls; let i = index">
                                        <ng-container [formGroupName]="i">
                                            <div class="f-col">
                                                <ng-template
                                                    [ngIf]="styleCtrlGrp && styleCtrlGrp.get('isWorkflowdataSet').value===false"
                                                    [ngIfElse]="workflowField">
                                                    <pros-metadatafield-control
                                                        [moduleId]="selStyleWid && selStyleWid.objectType"
                                                        lebel="Field "
                                                        [selectedFldId]="selStyleWid && selStyleWid.defaultFilters && (selStyleWid.defaultFilters[i]).conditionFieldId"
                                                        (selectionChange)='onDefaultFilterChange($event,i)'
                                                        class="field-divider">
                                                    </pros-metadatafield-control>
                                                    <span class="col-spacer"></span>
                                                </ng-template>
                                            </div>
                                            
                                            <div class="f-col">
                                                <ng-template #workflowField>
                                                    <pros-workflowfield-control
                                                        [objectType]="selStyleWid && selStyleWid.objectType"
                                                        label="Field"
                                                        [selectedFldId]="selStyleWid && selStyleWid.defaultFilters && (selStyleWid.defaultFilters[i]).conditionFieldId"
                                                        (selectionChange)='onDefaultFilterChange($event,i)'
                                                        class="field-divider">
                                                    </pros-workflowfield-control>
                                                    <span class="col-spacer"></span>
                                                </ng-template>
                                            </div>
                                            <span class="col-spacer"></span>
                                            <div class="f-col">
                                                <pros-udr-condition-operators
                                                    [conditionalOperators]="conditionalOperators"
                                                    [selecetedOperator]="selStyleWid && selStyleWid.defaultFilters && (selStyleWid.defaultFilters[i]).conditionOperator"
                                                    (afterSelect)="operatorSelectionChng($event,i)"
                                                    class="field-divider">
                                                </pros-udr-condition-operators>
                                            </div>
                                            <span class="col-spacer"></span>
                                            <div class="f-col">
                                                <ng-template
                                                    [ngIf]="selStyleWid && selStyleWid.defaultFilters && (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD_EQUAL'
                                                    || (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD'
                                                    || (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD_GREATETHENEQUAL'
                                                    || (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD_GREATETHAN'
                                                    || (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD_LESSTHEN'
                                                    || (selStyleWid.defaultFilters[i]).conditionOperator==='FIELD2FIELD_LESSTHENEQUALTO'"
                                                    [ngIfElse]="fieldvalue">
                                                    <pros-metadatafield-control
                                                        [moduleId]="selStyleWid && selStyleWid.objectType"
                                                        lebel="Field "
                                                        [selectedFldId]="selStyleWid && selStyleWid.defaultFilters && (selStyleWid.defaultFilters[i]).conditionFieldEndValue"
                                                        (selectionChange)='onDefaultFilterChange($event,i)'
                                                        class="field-divider">
                                                    </pros-metadatafield-control>
                                                </ng-template>

                                                <ng-template #fieldvalue>
                                                    <div class="f-col value-set">
                                                    <mat-label>Value</mat-label>
                                                    <mat-form-field appearance="outline">
                                                        <input matInput formControlName="conditionFieldValue">
                                                    </mat-form-field>
                                                </div>
                                                </ng-template>
                                            </div>
                                            <span class="col-spacer"></span>
                                            <div class="f-col value-set">
                                                <button mat-button (click)="removeFilter(i)" matTooltip="Remove"
                                                    color="warn">
                                                    <mat-icon>remove_circle_outline</mat-icon>
                                                </button>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </ng-template>

                            <div class="f-row add-button">
                                <button mat-flat-button (click)="addMoreDefaultFilter()" color="accent">
                                    Add
                                </button>
                            </div>
                        </div>
                    </mat-expansion-panel>
                </mat-accordion>
            </div>
        </div>
    </div>
</mat-card>